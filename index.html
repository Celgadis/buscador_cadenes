<input type="file" id="fileInput" multiple />
<script>
  const palabrasClave = [
    {
      palabra: "color:",
      contador: 0,
      resultados: []
    },
    {
      palabra: "border:",
      contador: 0,
      resultados: []
    }];
  // const palabrasClave = ['color', 'border', 'fallo']; // Cambia esto segÃºn tus necesidades

  document.getElementById('fileInput').addEventListener('change', async (event) => {
    const archivos = Array.from(event.target.files);

    for (const archivo of archivos) {
      await procesarArchivo(archivo);
    }
    await descargarResultados();
  });

  // FunciÃ³n que lee un archivo y busca las palabras clave lÃ­nea por lÃ­nea
  async function procesarArchivo(archivo) {
    const contenido = await leerArchivoComoTexto(archivo);
    const lineas = contenido.split('\n');

    console.log(`ðŸ“„ Procesando archivo: ${archivo.name}`);

    for (let i = 0; i < lineas.length; i++) {
      const linea = lineas[i];
      for (const clave of palabrasClave) {
        let palabra = clave.palabra;
        if (linea.toLowerCase().includes(palabra.toLowerCase())) {
          let resultado = `[${archivo.name}] LÃ­nea ${i + 1}: ${linea}`;
          console.log(resultado);
          clave.contador++;
          clave.resultados.push(resultado);
        }
      }
    }
  }

  // FunciÃ³n para leer archivo como texto usando FileReader y promesa
  function leerArchivoComoTexto(archivo) {
    return new Promise((resolve, reject) => {
      const lector = new FileReader();

      lector.onload = (e) => resolve(e.target.result);
      lector.onerror = (e) => reject(e);

      lector.readAsText(archivo);
    });
  }


    async function descargarResultados() {
      // let resultado=JSON.stringify(palabrasClave)
      // 1. Convertimos el array en un string
      const contenido = JSON.stringify(palabrasClave)//resultados.join('\n');

      // 2. Creamos un blob con tipo texto
      const blob = new Blob([contenido], { type: 'text/plain' });

      // 3. Creamos un URL para el blob
      const url = URL.createObjectURL(blob);

      // 4. Creamos un <a> y simulamos un clic
      const enlace = document.createElement('a');
      enlace.href = url;
      enlace.download = 'resultados.json';
      document.body.appendChild(enlace);
      enlace.click();

      // 5. Limpiamos
      document.body.removeChild(enlace);
      URL.revokeObjectURL(url);
    }

</script>